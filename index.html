<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>SQUAD TACTICS v2.1 - HEROES OF THE SECTOR</title>
    <style>
        :root { --bg: #0b0e0a; --panel: #1a1a1a; --text: #bbb; --accent: #d84; --border: #444; }
        body {
            background-color: #000; color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; height: 100vh; display: flex; overflow: hidden;
            user-select: none;
        }

        #app { display: flex; width: 100%; height: 100%; }
        #game-view { flex: 1; position: relative; overflow: hidden; cursor: crosshair; background: var(--bg); }
        canvas { display: block; width: 100%; height: 100%; position: absolute; top: 0; left: 0; }

        /* Sidebar */
        #sidebar {
            width: 320px; background: var(--panel); border-left: 2px solid var(--border);
            display: flex; flex-direction: column; z-index: 20;
            box-shadow: -5px 0 20px rgba(0,0,0,0.8);
        }
        .panel-header {
            background: #111; padding: 10px; font-weight: bold; color: var(--accent);
            border-bottom: 1px solid var(--border); letter-spacing: 1px; font-size: 11px;
            display: flex; justify-content: space-between; align-items: center;
        }
        #unit-info { padding: 15px; border-bottom: 1px solid var(--border); min-height: 260px; background: #222; }
        #log-container { 
            flex: 1; overflow-y: auto; padding: 10px; 
            font-family: "Lucida Console", monospace; font-size: 11px; 
            background: #000; color: #5c5; text-shadow: 0 0 2px #0f0;
            user-select: text; cursor: text;
        }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #222; padding-bottom: 2px; }
        
        button {
            background: linear-gradient(to bottom, #444, #333); border: 1px solid #555;
            color: #ddd; padding: 8px; width: 100%; cursor: pointer;
            font-weight: bold; text-transform: uppercase; margin-top: 5px;
            transition: 0.1s; font-size: 11px;
        }
        button:hover { background: #555; border-color: #777; color: #fff; }
        button:active { transform: translateY(1px); }
        button.disabled { opacity: 0.3; pointer-events: none; filter: grayscale(100%); cursor: not-allowed; }

        .btn-stance { width: 32%; display: inline-block; font-size: 10px; margin: 0; padding: 6px 0; }
        .active-stance { background: #d84; border-color: #fa6; color: #200; box-shadow: 0 0 8px #d84; }
        
        #btn-weapon {
            background: #222; border: 1px solid #d84; color: #d84; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center; padding: 10px; cursor: pointer;
        }
        #btn-weapon:hover { background: #322; color: #fa6; }
        .ap-cost { font-size: 9px; background: #000; color: #d84; padding: 2px 4px; border-radius: 3px; }

        .skill-list { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 5px; }
        .skill-badge {
            background: #234; color: #acf; border: 1px solid #468;
            font-size: 9px; padding: 2px 4px; border-radius: 3px;
        }
        .hero-badge { color: #fd0; border-color: #fd0; background: #430; }

        #auto-toggle {
            position: absolute; bottom: 10px; left: 10px; z-index: 50;
            background: rgba(0,0,0,0.8); border: 1px solid #555; color: #888;
            padding: 5px 10px; cursor: pointer; font-size: 12px; font-weight: bold;
            display: flex; align-items: center; gap: 5px; border-radius: 4px; pointer-events: auto;
        }
        #auto-toggle.active { color: #0f0; border-color: #0f0; box-shadow: 0 0 10px #0f0; }
        .indicator { width: 8px; height: 8px; background: #444; border-radius: 50%; }
        #auto-toggle.active .indicator { background: #0f0; box-shadow: 0 0 5px #0f0; }

        #sector-counter {
            position: absolute; top: 10px; right: 340px; z-index: 50;
            font-size: 24px; font-weight: 900; color: #d84; letter-spacing: 2px;
            text-shadow: 0 0 10px #000; pointer-events: none;
        }

        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10,12,10,0.95); z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .card-container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; max-width: 900px; }
        
        .card {
            width: 170px; height: 260px; background: #222; border: 2px solid #555;
            padding: 0; display: flex; flex-direction: column; align-items: center;
            cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); user-select: none;
        }
        .card:hover { transform: translateY(-8px) scale(1.02); border-color: var(--accent); z-index: 10; background: #2a2a2a; }
        .card:active { transform: translateY(2px); }
        
        .card-badge {
            position: absolute; top: 5px; right: 5px; background: #d84; color: #000;
            font-weight: bold; padding: 2px 6px; border-radius: 4px; font-size: 14px;
            display: none; box-shadow: 0 0 5px #d84;
        }

        .card-img-box {
            width: 100%; height: 120px; background: #111; 
            border-bottom: 1px solid #444; display: flex; justify-content: center; align-items: center;
            position: relative;
        }
        .card-img-box img { width: 100%; height: auto; image-rendering: pixelated; }

        .card-body { padding: 10px; text-align: center; width: 100%; box-sizing: border-box; }
        .card h3 { color: var(--accent); margin: 5px 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .card p { font-size: 11px; color: #aaa; line-height: 1.4; margin: 5px 0; }

        #eyecatch {
            position: absolute; top: 40%; width: 100%; text-align: center;
            font-size: 48px; font-weight: 900; color: #d33; letter-spacing: 5px;
            text-shadow: 0 0 20px #000; pointer-events: none;
            opacity: 0; transition: opacity 0.5s; z-index: 80;
            background: rgba(0,0,0,0.7); padding: 20px 0; border-top: 2px solid #d33; border-bottom: 2px solid #d33;
        }
        
        #context-menu {
            position: absolute; display: none; background: rgba(0, 20, 30, 0.95);
            border: 1px solid #0af; padding: 10px; width: 220px; color: #fff;
            font-size: 11px; z-index: 50; box-shadow: 0 5px 15px rgba(0,0,0,0.8);
            pointer-events: none;
        }
    </style>
</head>
<body>

<div id="app">
    <div id="game-view">
        <canvas id="cvs"></canvas>
        <div id="sector-counter">SECTOR: 01</div>
        <div id="eyecatch">ENEMY PHASE</div>
        <div id="context-menu"></div>
        <div id="auto-toggle" onclick="game.toggleAuto()">
            <div class="indicator"></div> AUTO PILOT
        </div>
        
        <div id="setup-screen" class="overlay">
            <h1 style="color:#d84; font-size:24px; letter-spacing:2px; border-bottom:2px solid #d84; margin-bottom:20px;">DEPLOYMENT PHASE</h1>
            <p style="color:#ccc; margin-bottom:20px;">部隊を選択してください（残り <span id="slots-left" style="color:#d84; font-weight:bold;">3</span> 枠）</p>
            <div class="card-container" id="setup-cards"></div>
            <button id="btn-start" style="width:200px; margin-top:30px; border:2px solid #d84; background:#421; display:none;" onclick="game.startCampaign()">>>> EXECUTE MISSION</button>
        </div>

        <div id="reward-screen" class="overlay" style="display:none;">
            <h1 style="color:#da4; font-size:32px; text-shadow:0 0 10px #da4;">SECTOR CLEARED!</h1>
            <p style="margin-bottom:20px;">司令部より補給物資が投下されました。</p>
            <div class="card-container" id="reward-cards"></div>
        </div>

        <div id="gameover-screen" class="overlay" style="display:none; background:rgba(30,0,0,0.9);">
            <h1 style="color:#f33; font-size:48px; text-shadow:0 0 20px #f00;">MISSION FAILED</h1>
            <p style="color:#eaa;">全戦力が失われました。</p>
            <button style="width:200px; margin-top:30px; border:2px solid #f33; background:#300;" onclick="location.reload()">RETRY</button>
        </div>
    </div>

    <div id="sidebar">
        <div class="panel-header">SELECTED UNIT</div>
        <div id="unit-info">
            <div style="text-align:center; color:#555; margin-top:80px;">// NO SIGNAL //</div>
        </div>
        
        <div class="panel-header">TACTICAL LOG</div>
        <div id="log-container"></div>
    </div>
</div>

<script src="data.js"></script>
<script src="renderer.js"></script>
<script src="logic.js"></script>

<script>
    const game = new Game();
</script>

</body>
</html>
